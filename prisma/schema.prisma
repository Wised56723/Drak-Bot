// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// ... (bloco 'generator client' não muda) ...
generator client {
  provider = "prisma-client-js"
}

// --- ALTERAÇÃO AQUI ---
// Mudamos o 'provider' de "sqlite" para "postgresql"
// Isto prepara o bot para se conectar a uma base de dados real na Railway.
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
// --- FIM DA ALTERAÇÃO ---

model Usuario {
  id_discord String   @id
  nome       String
  email      String   @unique
  
  referral_code String? @unique 
  
  compras             Compras[]
  premios_instantaneos PremiosInstantaneos[]
  indicacoes_feitas   Compras[]             @relation("Indicador")
}

model Rifa {
  id_rifa           Int       @id @default(autoincrement())
  nome_premio       String
  total_bilhetes    Int
  status            String    @default("ativa")
  metodo_sorteio    String
  meta_completude   Float?
  channel_id        String?
  message_id        String?
  preco_bilhete     Float
  sorteio_data      DateTime?
  top_compradores_count   Int     @default(0)
  top_compradores_premios String?
  
  compras             Compras[]
  premios_instantaneos PremiosInstantaneos[]
}

model Compras {
  id_compra     Int      @id @default(autoincrement())
  id_rifa_fk    Int
  id_usuario_fk String
  data_compra   DateTime
  quantidade    Int
  status        String   @default("em_analise")
  id_indicador_fk String?

  rifa      Rifa      @relation(fields: [id_rifa_fk], references: [id_rifa])
  usuario   Usuario   @relation(fields: [id_usuario_fk], references: [id_discord])
  bilhetes  Bilhetes[]
  
  indicador Usuario? @relation("Indicador", fields: [id_indicador_fk], references: [id_discord])
}

model Bilhetes {
  id_bilhete     Int    @id @default(autoincrement())
  id_compra_fk   Int
  numero_bilhete String
  is_free        Boolean @default(false)
  
  compra Compras @relation(fields: [id_compra_fk], references: [id_compra], onDelete: Cascade)
}

model PremiosInstantaneos {
  id_premio                Int      @id @default(autoincrement())
  id_rifa_fk               Int
  numero_bilhete           String
  descricao_premio         String
  status                   String   @default("pendente")
  id_usuario_vencedor_fk   String?
  
  rifa     Rifa     @relation(fields: [id_rifa_fk], references: [id_rifa], onDelete: Cascade)
  usuario  Usuario? @relation(fields: [id_usuario_vencedor_fk], references: [id_discord])
}